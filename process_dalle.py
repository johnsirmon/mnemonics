import os
import re
from datetime import datetime

def process_images():
    image_dir = "./images"
    image_files = os.listdir(image_dir)

    extracted_data = []

    for image_file in image_files:
        match = re.match(r".*DALL·E (\d{4}-\d{2}-\d{2} \d{2}\.\d{2}\.\d{2}) - (.*)\.png", image_file)
        if match:
            # Extract generated_by, date_generated, and llm_prompt
            generated_by = "DALL·E"
            date_generated = datetime.strptime(match.group(1), "%Y-%m-%d %H.%M.%S")
            llm_prompt = match.group(2)

            # Append to CSV file
            with open("./prompts/extracted_data.csv", "a") as f:
                f.write(f"{generated_by},{date_generated},{llm_prompt}\n")

            # Append to extracted_data list
            extracted_data.append({
                "generated_by": generated_by,
                "date_generated": date_generated,
                "llm_prompt": llm_prompt
            })

            # Rename the file
            new_file_name = f"{generated_by}_{date_generated.strftime('%Y%m%d%H%M%S')}.png"
            full_old_path = os.path.join(image_dir, image_file)
            full_new_path = os.path.join(image_dir, new_file_name)
            os.rename(full_old_path, full_new_path)

    return extracted_data

# Execute the function and print the extracted data
extracted_data = process_images()
for data in extracted_data:
    print(f"Generated By: {data['generated_by']}, Generated Date: {data['date_generated']}, LLM Prompt: {data['llm_prompt']}")

